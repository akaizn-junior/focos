"use strict";
/*!
 * Focos
 * Add focus to elements on the screen referenced by coordinates
 * (c) 2019 Verdexdesign
 */var $$g={globalPoint:[0,0],ops:["up","down","left","right"],callback:function(){},focusWithTabIndex:!1};function nextPoint(t,o,e,s){var c=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1,n=t[0],l=t[1],a=o[0],i=o[1],u=c||1;return{up:function(e){var c=s-1;return l>=i&&l+u<=c?e?t:[n,l+u]:l>=c||l+u>=c?t:l<i?o:void 0},down:function(o){return l-u>=i?o?[a,s-1]:[n,l-u]:l<=i||l-u<=i?o?[a,s-1]:t:void 0},left:function(o){return n-u>=a?o?[e-1,i]:[n-u,l]:n<=a||n-u<=a?o?[e-1,i]:t:void 0},right:function(s){return n>=a&&n+u<=e-1?s?o:[n+u,l]:n>=e-1||n+u>=e-1?t:n<a?o:void 0}}}function focosSubject(t){if(t&&t.dataset.focosSubject){var o=t.dataset.focosSubject,e=o.includes("child")&&o&&o.split("-")[1];return e&&t.children[e]?t.children[e]:t}return t}function clearFocus(){var t=focosSubject(document.getElementsByClassName("focused")[0]);t&&(t.classList.remove("focused"),$$g.focusWithTabIndex&&t.removeAttribute("tabindex"))}function getCellValue(t,o){var e=Math.abs(o[0]),s=Math.abs(o[1]);return t[s]&&t[s][e]?t[s][e]:t[0][0]}function validFocosDataset(t){if(t){var o=parseInt(t.split(",")[0],10),e=parseInt(t.split(",")[1],10);return{cell:[o,e],"class":"focos-cell".concat(o,e)}}return{cell:[],"class":""}}function focusTarget(t){var o=focosSubject(t);o&&($$g.focusWithTabIndex&&o.setAttribute("tabindex","0"),o.focus&&o.focus(),o.classList.add("focused"))}function focusCell(t,o){var e=getCellValue(t,o);return focusTarget(e),$$g.callback(e,o)}function buildGrid(t,o){for(var e=Array.from({length:t},(function(){return[]})),s=0;s<o.length;s++){var c=o[s],n=focosSubject(c);if(c.dataset.focosCell){var l=validFocosDataset(c.dataset.focosCell);n.classList.add("focusable"),n.classList.add(l["class"]),e[l.cell[1]]&&e[l.cell[1]].push(n)}}return e}function focusFirst(t,o,e){t&&t.length&&e[0]===t[0]&&e[1]===t[1]&&focusCell(o,e)}function validOpts(t){var o=t.keys,e=t.initialFocus,s=t.step,c=t.gridSize,n=t.focusOnClick,l=t.focusWithTabIndex;!RegExp(/^[0-9]+x[0-9]+$/gm).test(c)&&(c="1x1");var a=parseInt(c.split("x")[0],10),i=parseInt(c.split("x")[1],10);return o=o||{37:"left",38:"up",39:"right",40:"down"},s=Math.floor(Math.abs(s))||1,$$g.focusWithTabIndex=l,{keys:o,initialFocus:e,step:s,size:{rows:a,cols:i},focusOnClick:n}}function run(t,o){var e=t.keys,s=t.initialFocus,c=t.step,n=t.size,l=t.focusOnClick,a=n.cols,i=n.rows,u=buildGrid(i,o);s&&($$g.globalPoint=s);var r=[0,0];focusFirst(s,u,$$g.globalPoint);var f=0;document.onmousedown=function(t){var o=t.target,e=o.dataset.focosCell;!e&&clearFocus(),e&&l&&($$g.globalPoint=validFocosDataset(o.dataset.focosCell).cell,clearFocus(),focusCell(u,$$g.globalPoint))},document.addEventListener("keyup",(function(t){t.preventDefault();var o=t.key,n=t.keyCode;if(e&&(e[o]||e[n])){var l=e[o]||e[n],d=0===f&&!s;-1!==$$g.ops.indexOf(l)&&($$g.globalPoint=nextPoint($$g.globalPoint,r,a,i,c)[l](d),clearFocus(),focusCell(u,$$g.globalPoint),f=1)}}))}function focos(t,o){o&&($$g.callback=o);var e=document.querySelectorAll("[data-focos-cell]");e.length&&run(validOpts(t),e)}window.focos=focos;