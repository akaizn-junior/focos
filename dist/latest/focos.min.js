"use strict";
/*!
 * Focos
 * Add focus to elements on the screen referenced by coordinates
 * (c) 2019 Verdexdesign
 */var $$g={globalPoint:[0,0],ops:["up","down","left","right"],callback:function(){},focusWithTabIndex:!1};function nextPoint(t,o,e,s){var n=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1,c=t[0],l=t[1],a=o[0],i=o[1],u=n||1;return{up:function(e){var n=s-1;return l>=i&&l+u<=n?e?t:[c,l+u]:l>=n||l+u>=n?t:l<i?o:void 0},down:function(o){return l-u>=i?o?[a,s-1]:[c,l-u]:l<=i||l-u<=i?o?[a,s-1]:t:void 0},left:function(o){return c-u>=a?o?[e-1,i]:[c-u,l]:c<=a||c-u<=a?o?[e-1,i]:t:void 0},right:function(s){return c>=a&&c+u<=e-1?s?o:[c+u,l]:c>=e-1||c+u>=e-1?t:c<a?o:void 0}}}function focosSubject(t){if(t&&t.dataset.focosSubject){var o=t.dataset.focosSubject,e=o.includes("child")&&o&&o.split("-")[1];return e&&t.children[e]?t.children[e]:t}return t}function clearFocus(){var t=document.getElementsByClassName("focused")[0];t&&(t.classList.remove("focused"),$$g.focusWithTabIndex&&t.removeAttribute("tabindex"))}function getCellValue(t,o){var e=Math.abs(o[0]),s=Math.abs(o[1]);return t[s]&&t[s][e]?t[s][e]:t[0][0]}function validFocosDataset(t){if(t){var o=parseInt(t.split(",")[0],10),e=parseInt(t.split(",")[1],10);return{cell:[o,e],"class":"focos-cell".concat(o,e)}}return{cell:[],"class":""}}function focusTarget(t){var o=focosSubject(t);o&&($$g.focusWithTabIndex&&t.setAttribute("tabindex","0"),o.focus&&o.focus(),t.classList.add("focused"))}function focusCell(t,o){var e=getCellValue(t,o);return focusTarget(e),$$g.callback(e,o)}function buildGrid(t,o){for(var e=Array.from({length:t},(function(){return[]})),s=0;s<o.length;s++){var n=o[s];if(n.dataset.focosCell){var c=validFocosDataset(n.dataset.focosCell);n.classList.add("focusable"),n.classList.add(c["class"]),e[c.cell[1]]&&e[c.cell[1]].push(n)}}return e}function focusFirst(t,o,e){t&&t.length&&e[0]===t[0]&&e[1]===t[1]&&focusCell(o,e)}function validOpts(t){var o=t.keys,e=t.initialFocus,s=t.step,n=t.gridSize,c=t.focusOnClick,l=t.focusWithTabIndex;!RegExp(/^[0-9]+x[0-9]+$/gm).test(n)&&(n="1x1");var a=parseInt(n.split("x")[0],10),i=parseInt(n.split("x")[1],10);return o=o||{37:"left",38:"up",39:"right",40:"down"},s=Math.floor(Math.abs(s))||1,$$g.focusWithTabIndex=l,{keys:o,initialFocus:e,step:s,size:{rows:a,cols:i},focusOnClick:c}}function run(t,o){var e=t.keys,s=t.initialFocus,n=t.step,c=t.size,l=t.focusOnClick,a=c.cols,i=c.rows,u=buildGrid(i,o);s&&($$g.globalPoint=s);var r=[0,0];focusFirst(s,u,$$g.globalPoint);var f=0;document.onmousedown=function(t){var o=t.target,e=o.dataset.focosCell;!e&&clearFocus(),e&&l&&($$g.globalPoint=validFocosDataset(o.dataset.focosCell).cell,clearFocus(),focusCell(u,$$g.globalPoint))},document.addEventListener("keyup",(function(t){t.preventDefault();var o=t.key,c=t.keyCode;if(e&&(e[o]||e[c])){var l=e[o]||e[c],d=0===f&&!s;-1!==$$g.ops.indexOf(l)&&($$g.globalPoint=nextPoint($$g.globalPoint,r,a,i,n)[l](d),clearFocus(),focusCell(u,$$g.globalPoint),f=1)}}))}function focos(t,o){o&&($$g.callback=o);var e=document.querySelectorAll("[data-focos-cell]");e.length&&run(validOpts(t),e)}window.focos=focos;