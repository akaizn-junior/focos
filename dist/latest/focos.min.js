"use strict";
/*!
 * Focos
 * Add focus to elements on the screen referenced by coordinates
 * (c) 2019 Verdexdesign
 */var $$g={globalPoint:[0,0],ops:["up","down","left","right"],callback:function(){}};function nextPoint(t,e,o,l){var s=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1,n=t[0],a=t[1],c=e[0],i=e[1],r=s||1;return{up:function(o){var s=l-1;return a>=i&&a+r<=s?o?t:[n,a+r]:a>=s||a+r>=s?t:a<i?e:void 0},down:function(e){return a-r>=i?e?[c,l-1]:[n,a-r]:a<=i||a-r<=i?e?[c,l-1]:t:void 0},left:function(e){return n-r>=c?e?[o-1,i]:[n-r,a]:n<=c||n-r<=c?e?[o-1,i]:t:void 0},right:function(l){return n>=c&&n+r<=o-1?l?e:[n+r,a]:n>=o-1||n+r>=o-1?t:n<c?e:void 0}}}function clearFocus(){var t=document.getElementsByClassName("focused")[0];t&&(t.classList.remove("focused"),t.removeAttribute("tabindex"))}function getCellValue(t,e){var o=Math.abs(e[0]),l=Math.abs(e[1]);return t[l]&&t[l][o]?t[l][o]:t[0][0]}function validFocosDataset(t){if(t){var e=parseInt(t.split(",")[0],10),o=parseInt(t.split(",")[1],10);return{cell:[e,o],"class":"cell".concat(e,o)}}return{cell:[],"class":""}}function focusTarget(t){t&&t.focus&&(t.setAttribute("tabindex","0"),t.focus(),t.classList.add("focused"))}function focusCell(t,e){var o=getCellValue(t,e);return focusTarget(o),$$g.callback(o,e)}function buildGrid(t,e){for(var o=Array.from({length:t},(function(){return[]})),l=0;l<e.length;l++){var s=e[l];if(s.dataset.focosCell){s.classList.add("focusable");var n=validFocosDataset(s.dataset.focosCell);s.classList.add(n["class"]),o[n.cell[1]]&&o[n.cell[1]].push(s)}}return o}function focusFirst(t,e,o){t&&t.length&&o[0]===t[0]&&o[1]===t[1]&&focusCell(e,o)}function validOpts(t){var e=t.keys,o=t.initialFocus,l=t.step,s=t.gridSize,n=t.focusOnClick;!RegExp(/^[0-9]+x[0-9]+$/gm).test(s)&&(s="1x1");var a=parseInt(s.split("x")[0],10),c=parseInt(s.split("x")[1],10);return{keys:e=e||{37:"left",38:"up",39:"right",40:"down"},initialFocus:o,step:l=Math.floor(Math.abs(l))||1,size:{rows:a,cols:c},focusOnClick:n}}function focosInner(t,e){var o=validOpts(t),l=o.keys,s=o.initialFocus,n=o.step,a=o.size,c=o.focusOnClick;e&&($$g.callback=e);var i=document.querySelectorAll("[data-focos-cell]"),r=a.cols,u=a.rows,f=buildGrid(u,i);s&&($$g.globalPoint=s);var d=[0,0];focusFirst(s,f,$$g.globalPoint);var g=0;document.onmousedown=function(t){var e=t.target,o=e.dataset.focosCell;!o&&clearFocus(),o&&c&&($$g.globalPoint=validFocosDataset(e.dataset.focosCell).cell,clearFocus(),focusCell(f,$$g.globalPoint))},document.addEventListener("keyup",(function(t){t.preventDefault();var e=t.key,o=t.keyCode;if(l&&(l[e]||l[o])){var a=l[e]||l[o],c=0===g&&!s;-1!==$$g.ops.indexOf(a)&&($$g.globalPoint=nextPoint($$g.globalPoint,d,r,u,n)[a](c),clearFocus(),focusCell(f,$$g.globalPoint),g=1)}}))}window.focos=focosInner;